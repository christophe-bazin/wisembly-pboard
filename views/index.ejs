<!doctype html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title></title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="css/tapestry.css" type="text/css">
		<link rel="stylesheet" href="css/main.css" type="text/css">

	</head>
	<body>

		<div class="wisembly-pboard">

			<header>
				<h1>Wisembly Product Board</h1>
				
				<div class="login">
					<div id="loggedout">
						<a id="connectLink" class="Btn Btn--validate" href="#">Se connecter avec Trello</a>
					</div>

					<div id="loggedin" style="display: none;">
						<div id="disconnect">
							<a class="Btn Btn--status" href="#">Se déconnecter</a>
						</div>
						<div id="output"></div>
					</div>
				</div>
			</header>

			<hr />

			<div class="Grid u-mgb--m">
				<div class="Grid-cell Grid-cell--4">
					<input class="Input" type="text" placeholder="Search..." id="search_field">
				</div>
			</div>

			<table class="Table tablesorter" id="trelloDatas">
				<thead class="Table-head">
					<tr class="Table-row">
						<th class="Table-cell Table-cell--header u-tal"><i class="Icon Icon--results Icon--s"></i> Feature</th>
						<th class="Table-cell Table-cell--header u-tal"><i class="Icon Icon--results Icon--s"></i> Name</th>
						<th class="Table-cell Table-cell--header"><i class="Icon Icon--results Icon--s"></i> Date</th>
						<th class="Table-cell Table-cell--header u-tal"><i class="Icon Icon--results Icon--s"></i> Type</th>
						<th class="Table-cell Table-cell--header"><i class="Icon Icon--results Icon--s"></i> Votes</th>
						<th class="Table-cell Table-cell--header"><i class="Icon Icon--results Icon--s"></i> Priorité</th>
					</tr>
				</thead>
				<tbody class="Table-body">
					<% data.forEach(function(rowData){ %>
					<tr class="<%= rowData.id %>">
						<td class='Table-cell u-tal'>
							<%= rowData.labels.map(function(label) { return label.name }).filter(function (label) {return label.indexOf('Feature :')>-1; }) %>
						</td>
						<td class='Table-cell u-tal'>
							<%= rowData.name %>
						</td>
						<td class='Table-cell u-tal'>
							<%= rowData.dateLastActivity %>
						</td>
						<td class='Table-cell u-tal'>
							<%= rowData.labels.map(function(label) { return label.name }).filter(function (label) {return label === ('Improvement') || label === ('Feature'); }) %>								
						</td>
						<td class='Table-cell' style="width: 100px">
							<button type="button" class="Btn vote">
								<i class="Btn-icon Icon Icon--like"></i> 
								<span class="count"><%= Object.keys(rowData.idMembersVoted).length %></span>
							</button>
						</td>
						<td class='Table-cell u-tal'>
							<%= rowData.labels.map(function(label) { return label.name }).filter(function (label) {return label.indexOf('(P')>-1; }) %>
						</td>
					</tr>
					<% }); %>
				</tbody>
			</table>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="/bower_components/tablesorter/dist/js/jquery.tablesorter.js"></script>
		<script src="https://api.trello.com/1/client.js?key=4ed75158af45aeeb2df0525d0af7e52c"></script>
		<script src="/js/main.js"></script>
	</body>
</html>
